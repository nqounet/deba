# Deba アジャイル開発計画

## 0. 方針

### 0.1 開発原則

| 原則 | 内容 |
|------|------|
| **CLI First** | GUIは後回し。CLIインタラクティブモードで動作確認できたら次へ進む |
| **入出力の透明性** | 全フェーズで「何を入力し、何が出力されたか」をファイルに保存し、対比可能にする |
| **1スプリント = 1検証可能な成果物** | 各スプリントの完了時に「動かして確認できるもの」がある |
| **手戻り最小化** | 上流（Phase A）から検証し、上流が安定してから下流に進む |
| **設計ドキュメントとの対応** | 既存の設計書（001〜005）を参照しつつ、実装は必要最小限から始める |
| **Portable Agent** | 知識や作業場をプロジェクト内に保持し、ポータビリティを確保する |

### 0.2 検証の仕組み: 入出力スナップショット

全てのLLM呼び出しで、以下のセットを自動保存する。これにより「何が起きたか」を事後に対比・再現できる。

```
snapshots/
└── {task_id}/
    ├── input.md          # LLMに送ったプロンプト全文
    ├── output_raw.txt    # LLMから返ってきた生テキスト
    ├── output_parsed.yml # パース後の構造化データ（成功時）
    └── meta.json         # タイムスタンプ、モデル名、トークン数、所要時間
```

---

## 1. スプリント構成（進捗状況）

| Sprint | ステータス | 成果物 |
|--------|------------|--------|
| **Sprint 0** | ✅ 完了 | プロジェクトセットアップ, CLI最小構成, snapshots |
| **Sprint 1** | ✅ 完了 | `deba plan` (Phase A: 計画立案) |
| **Sprint 2** | ✅ 完了 | `deba validate` (YAML検証, 依存グラフ) |
| **Sprint 3** | ✅ 完了 | `deba execute` (Phase B: 実装実行) |
| **Sprint 4** | ✅ 完了 | `deba run` (Phase A→B 結合, Git Worktree 隔離) |
| **Sprint 5** | ✅ 完了 | `deba review` (Phase C), Episode 記録, 成長ログ |
| **Sprint 6** | 🚀 進行中 | スキル整理 (`consolidate-skills`), コンテキスト注入 |

---

## 2. 各スプリントの詳細（直近の進捗）

### Sprint 4: Phase A → B 結合 (✅ 完了)
- **隔離環境の実装**: `.worktrees/` ディレクトリ内での Git Worktree 運用。メイン作業ディレクトリを汚さない実行環境を構築。
- **一気通貫実行**: 計画から実装、マージまでのオートメーション。

### Sprint 5: Phase C とエピソード記録 (✅ 完了)
- **フィードバックループ**: `deba review` による人間との対話的な学び抽出。
- **脳の構造化**: `brain/episodes/` への詳細記録と `brain/growth_log/` への集約。

### Sprint 6: 成長サイクル統合 (🚀 進行中)
- **スキル自動整理**: `maintenance consolidate-skills` による、蓄積された箇条書き規約の LLM によるリファクタリング。
- **コンテキスト注入**: 過去の学び（意味記憶）を Phase A のプロンプトに動的に注入し、再発防止を実現。

---

## 3. 技術的な判断ポイント（更新済み）

| 判断項目 | 決定内容 | 理由 |
|---------|--------|---------|
| 実装言語 | TypeScript (NodeNext) | 型安全、豊富なライブラリ、CLI の書きやすさ |
| LLM API | Gemini (via gemini-cli) | JSON 出力、ロングコンテキスト、高速なレスポンス |
| 隔離環境 | Git Worktree | プロジェクトのポータビリティ、レビューの容易さ |
| 知識管理 | Markdown + JSON | 人間が読める形式での知識蓄積（エピソード記憶） |

---

## 4. やらないこと（スコープ外）

- GUI（Electron等）の実装
- オフライン対応
- マスキング処理
- 信頼レベルの自動昇格
- コスト上限管理
